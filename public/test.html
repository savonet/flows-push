<html>
<head>
  <title>Flows notification test page</title>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var url = "http://" + window.location.hostname + ":" + window.location.port;
    var socket = io.connect(url);
    var radio;

    socket.on('joined', function (radio) {
      if (radio === "flows") {
        document.getElementById("content").innerHTML+="Successfully joined flows notification channel.<br/>";
      } else {
        document.getElementById("content").innerHTML+="Successfully joined notification channel for radio: " + JSON.stringify(radio) + ".<br/>";
      }  
    });

    socket.emit('join', 'flows');
    
    socket.on('flows', function (msg) {
      document.getElementById("content").innerHTML+="Generic data: " + JSON.stringify(msg) + "</br>";
      if (radio === undefined) {
        if (msg.radio !== undefined && msg.radio.token !== undefined) {
          radio = msg.radio.name;
          socket.emit("join", msg.radio.token);
          socket.on(msg.radio.token, function (data) {
            document.getElementById("content").innerHTML+="Data for radio " + radio + ": " + JSON.stringify(data) + "</br>";
          });
        }
      }
    });
  </script>
</head>
<body>
  <h1>Flows notification test</h1>
  <p id="content">Waiting..<br/></p>
</body>
</html>
