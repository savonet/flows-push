<script>
    var url = "http://" + window.location.hostname + ":" + window.location.port;
    var socket = io.connect(url);
    var radio;

    function appendData(text, msg) {
      $("#content").append(text + "<br/>");
      var el = $("<pre>" + JSON.stringify(msg, undefined, "  ") + "</pre>");
      $("#content").append(el);
    }

    socket.on('joined', function (radio) {
      if (radio === "flows") {
        $("#content").append("Successfully joined flows notification channel.<br/>");
      } else {
        appendData("Successfully joined a notification channel.", radio);
      }  
    });

    socket.emit('join', 'flows');
    
    socket.on('flows', function (msg) {
      appendData("Generic data", msg);
      if (radio === undefined) {
        if (msg.radio !== undefined && msg.radio.token !== undefined) {
          radio = msg.radio.name;
          socket.emit("join", msg.radio.token);
          socket.on(msg.radio.token, function (data) {
             appendData("Data for radio " + radio, data);           
          });
        }
      }
    });
</script>
<div class="section" id="main">
  <h1>Flows notification test</h1>
  <div class="content">
    <p id="content">Waiting..<br/></p>
  </div>
</div>
